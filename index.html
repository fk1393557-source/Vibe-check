<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>For You ‚ú®</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Patrick+Hand&family=Inter:wght@400;600&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg: #fdf6f0;
            --text: #5c4d42;
            --paper-lines: rgba(92, 77, 66, 0.08);
            --primary: #d4a373;
            --sticker-front: #fffcf2;
            --sticker-back: #f4e4bc;
        }

        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            background-color: var(--bg);
            background-image: linear-gradient(var(--paper-lines) 1px, transparent 1px);
            background-size: 100% 35px;
            font-family: 'Inter', sans-serif;
            overflow: hidden; touch-action: none;
            transition: background 1s;
            cursor: none;
        }

        /* --- üñçÔ∏è DOODLE CURSOR --- */
        #doodle-cursor {
            position: fixed; top: 0; left: 0; width: 35px; height: 35px;
            pointer-events: none; z-index: 9999;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='35' height='35' viewBox='0 0 24 24'%3E%3Cpath fill='%23ffffff' stroke='%23000000' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round' d='M5.5 2.5l7.5 18l3.5-7.5l7.5-2l-18.5-8.5z'/%3E%3C/svg%3E");
            background-size: contain; background-repeat: no-repeat;
            transform-origin: top left;
            animation: breathe-cursor 2s ease-in-out infinite;
        }
        @keyframes breathe-cursor { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        #doodle-cursor.hovering { animation: none; transform: rotate(-15deg) scale(1.1); filter: drop-shadow(2px 2px 2px rgba(0,0,0,0.1)); }
        #doodle-cursor.clicking { transform: scale(0.9); }
        button, .sticker, .tool-btn, .main-menu-btn, .option-sticker, .credits-btn, .next-btn, a { cursor: none !important; }

        /* --- PAPER TRANSITIONS (New!) --- */
        .paper-slide-out {
            animation: slideOut 0.8s ease-in-out forwards;
        }
        .paper-slide-in {
            animation: slideIn 0.8s ease-in-out forwards;
        }

        @keyframes slideOut {
            0% { transform: translateX(0) rotate(0deg); opacity: 1; }
            100% { transform: translateX(-120%) rotate(-10deg); opacity: 0.8; }
        }
        @keyframes slideIn {
            0% { transform: translateX(120%) rotate(10deg); opacity: 0.8; }
            100% { transform: translateX(0) rotate(0deg); opacity: 1; }
        }

        /* --- GENERAL UI --- */
        .grain-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 9000; opacity: 0.05; background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E"); }
        
        #start-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #fdf6f0; z-index: 5000; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: opacity 1s ease-in-out, visibility 1s; perspective: 800px; }
        #background-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; pointer-events: none; overflow: hidden; }
        
        .bg-item { position: absolute; top: 110%; opacity: 0; animation: riseUp linear infinite; }
        @keyframes riseUp { 0% { top: 110%; transform: rotate(0deg); opacity: 0; } 10% { opacity: 0.8; } 90% { opacity: 0.8; } 100% { top: -20%; transform: rotate(360deg); opacity: 0; } }

        .invite-text { position: relative; z-index: 10; font-family: 'Patrick Hand', cursive; color: #5c4d42; font-size: 1.8rem; text-align: center; margin-bottom: 70px; line-height: 1.4; max-width: 85%; pointer-events: none; text-shadow: 2px 2px 0px rgba(255,255,255,0.6); }
        .sticker-wrapper { position: relative; width: 240px; height: 70px; z-index: 20; transform: rotate(-4deg); box-shadow: 0px 10px 10px rgba(92, 77, 66, 0.1); border-radius: 50px; background: rgba(0,0,0,0.05); }
        .sticker { position: absolute; top: 0; left: 0; width: 100%; height: 100%; transform-style: preserve-3d; transform-origin: left center; transition: transform 0.1s; border-radius: 50px; }
        .face { position: absolute; top: 0; left: 0; width: 100%; height: 100%; backface-visibility: hidden; border-radius: 50px; display: flex; align-items: center; justify-content: center; font-family: 'Patrick Hand', cursive; font-size: 1.8rem; box-shadow: 2px 2px 5px rgba(0,0,0,0.1); border: 2px solid #5c4d42; }
        .face-front { background: var(--sticker-front); color: #5c4d42; z-index: 2; }
        .face-back { background: var(--sticker-back); color: #d4a373; transform: rotateY(180deg); box-shadow: inset 0 0 10px rgba(0,0,0,0.1); }
        .doodle-arrow { position: absolute; left: -50px; top: 20px; font-size: 2rem; color: #5c4d42; transform: rotate(-15deg); animation: bounceX 1s infinite alternate; font-family: 'Patrick Hand', cursive; pointer-events: none; }
        .doodle-sparkle { position: absolute; right: -30px; top: -30px; font-size: 2rem; color: #d4a373; animation: pulse 1.5s infinite; pointer-events: none; }
        @keyframes bounceX { from { transform: translateX(0) rotate(-15deg); } to { transform: translateX(-10px) rotate(-15deg); } }
        @keyframes pulse { 0% { opacity: 0.5; transform: scale(0.8); } 50% { opacity: 1; transform: scale(1.2); } 100% { opacity: 0.5; transform: scale(0.8); } }

        /* PAGE 2 UI */
        #page2-ui { display: none; opacity: 0; transition: opacity 1s; }
        #page2-title { position: fixed; top: 15%; left: 50%; transform: translate(-50%, -50%); font-family: 'Patrick Hand', cursive; font-size: 2rem; color: #5c4d42; opacity: 1; pointer-events: none; transition: opacity 1.5s ease-out; width: 100%; text-align: center; z-index: 5; }
        .credits-container { position: fixed; top: 25px; right: 25px; z-index: 2000; display: flex; flex-direction: column; align-items: flex-end; }
        .credits-btn { background: rgba(255,255,255,0.8); border: 1px solid rgba(255,255,255,0.6); padding: 8px 18px; border-radius: 30px; color: var(--text); font-size: 0.75rem; font-weight: 600; text-transform: uppercase; backdrop-filter: blur(8px); }
        .credits-dropdown { margin-top: 15px; background: rgba(255,255,255,0.95); border-radius: 20px; padding: 20px; min-width: 140px; opacity: 0; transform: translateY(-10px); pointer-events: none; transition: 0.3s; position: absolute; top: 40px; right: 0; box-shadow: 0 10px 30px rgba(0,0,0,0.05); }
        .credits-dropdown.show { opacity: 1; transform: translateY(0); pointer-events: auto; }
        .credit-item { margin-bottom: 8px; font-size: 0.7rem; color: #999; border-bottom: 1px solid #eee; padding-bottom: 4px; }
        .credit-name { display: block; color: var(--text); font-weight: 600; font-size: 0.85rem; }
        .menu-container { position: fixed; bottom: 30px; right: 30px; z-index: 3000; display: flex; flex-direction: column-reverse; align-items: center; gap: 15px; }
        .main-menu-btn { width: 65px; height: 65px; background: #4a3b32; color: #fffcf2; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; box-shadow: 0 8px 20px rgba(74, 59, 50, 0.3); transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); z-index: 3002; pointer-events: auto; }
        .tool-list { display: flex; flex-direction: column-reverse; gap: 12px; align-items: center; margin-bottom: 5px; pointer-events: none; }
        .tool-btn { width: 50px; height: 50px; background: rgba(255,255,255,0.9); border: 1px solid white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.3rem; box-shadow: 0 4px 10px rgba(0,0,0,0.05); backdrop-filter: blur(5px); opacity: 0; transform: translateY(20px) scale(0.8); transition: all 0.3s cubic-bezier(0.4, 0.0, 0.2, 1); pointer-events: auto; }
        .menu-open .tool-btn { opacity: 1; transform: translateY(0) scale(1); }
        .menu-open .main-menu-btn { transform: rotate(45deg); background: #d64933; }
        .menu-open .tool-btn:nth-child(1) { transition-delay: 0.05s; } .menu-open .tool-btn:nth-child(2) { transition-delay: 0.1s; } .menu-open .tool-btn:nth-child(3) { transition-delay: 0.15s; } .menu-open .tool-btn:nth-child(4) { transition-delay: 0.2s; }
        .tool-btn.active-tool { background: #ff6b6b; color: white; border-color: #ff6b6b; transform: scale(1.1) !important; }
        .next-btn { position: fixed; bottom: 30px; left: 30px; z-index: 4000; background: white; border: 2px solid var(--text); padding: 12px 25px; border-radius: 20px; font-family: 'Patrick Hand', cursive; font-size: 1.2rem; box-shadow: 3px 3px 0px var(--primary); transform: rotate(-2deg); transition: transform 0.2s; }
        .next-btn:active { transform: rotate(-2deg) scale(0.95); }

        /* PAGES 3 & 4 (Rain Effects) */
        #intermediate-page { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 7000; background: var(--bg); display: none; flex-direction: column; align-items: center; justify-content: center; opacity: 0; transition: opacity 0.8s; background-image: linear-gradient(var(--paper-lines) 1px, transparent 1px); background-size: 100% 35px; overflow: hidden; }
        .intermediate-text { position: relative; z-index: 10; font-family: 'Patrick Hand', cursive; font-size: 1.8rem; color: var(--text); text-align: center; margin-bottom: 50px; padding: 0 20px; max-width: 85%; line-height: 1.5; }
        
        #question-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 8000; background: var(--bg); display: none; flex-direction: column; align-items: center; justify-content: center; opacity: 0; transition: opacity 0.8s; background-image: linear-gradient(var(--paper-lines) 1px, transparent 1px); background-size: 100% 35px; transition: background 1s; overflow: hidden; }
        
        /* RAIN ELEMENTS */
        .falling-item { position: absolute; top: -100px; pointer-events: none; }
        
        /* Page 3 Vectors */
        .falling-vector { 
            font-family: 'Patrick Hand', cursive; 
            color: rgba(92, 77, 66, 0.3); 
            font-size: 1.5rem; 
            z-index: 1; 
            animation: fallDownVector linear infinite; 
        }

        /* Page 4 Elements */
        .falling-envelope { z-index: 1; font-size: 2rem; opacity: 0.3; animation: fallDownEnvelope linear infinite; }
        
        @keyframes fallDownVector { 0% { top: -10%; transform: rotate(0deg); } 100% { top: 110%; transform: rotate(180deg); } }
        @keyframes fallDownEnvelope { 0% { top: -10%; transform: rotate(0deg); } 100% { top: 110%; transform: rotate(20deg); } }

        .question-text { position: relative; z-index: 50; font-family: 'Patrick Hand', cursive; font-size: 2.5rem; color: var(--text); text-align: center; margin-bottom: 50px; max-width: 80%; line-height: 1.2; animation: breathe 3s ease-in-out infinite; }
        @keyframes breathe { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        .option-group { position: relative; z-index: 50; display: flex; flex-wrap: wrap; justify-content: center; max-width: 320px; gap: 15px; }
        .option-sticker { padding: 12px 25px; border: 2px solid var(--text); background: white; font-family: 'Patrick Hand', cursive; font-size: 1.3rem; border-radius: 255px 15px 225px 15px / 15px 225px 15px 255px; transition: transform 0.2s; box-shadow: 3px 3px 0px rgba(0,0,0,0.1); user-select: none; }
        .option-sticker:active { transform: scale(0.9) !important; }
        #btn-nah { position: relative; transition: top 0.2s, left 0.2s; } 
        #final-msg { margin-top: 40px; font-family: 'Patrick Hand', cursive; font-size: 1.6rem; color: #d4a373; text-align: center; min-height: 50px; padding: 0 20px; position:relative; z-index:50; }
        .glowing-text { color: #fff; text-align: center; font-family: 'Patrick Hand', cursive; font-size: 3rem; line-height: 1.4; text-shadow: 0 0 7px #fff, 0 0 10px #fff, 0 0 21px #fff, 0 0 42px #bc13fe, 0 0 82px #bc13fe; animation: flicker 2s infinite; }
        @keyframes flicker { 0%, 18%, 22%, 25%, 53%, 57%, 100% { text-shadow: 0 0 4px #fff, 0 0 11px #fff, 0 0 19px #fff, 0 0 40px #bc13fe, 0 0 80px #bc13fe, 0 0 90px #bc13fe; opacity: 1; } 20%, 24%, 55% { text-shadow: none; opacity: 0.4; } }
        .confetti { position: absolute; pointer-events: none; z-index: 9000; font-size: 1.5rem; }
        
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.3); z-index: 9000; display: none; align-items: center; justify-content: center; backdrop-filter: blur(3px); opacity: 0; transition: opacity 0.3s; }
        .modal-overlay.open { opacity: 1; }
        .paper-note { background: #fffcf2; width: 80%; max-width: 300px; padding: 30px; border-radius: 2px; box-shadow: 0 10px 30px rgba(0,0,0,0.15); font-family: 'Patrick Hand', cursive; font-size: 1.3rem; color: #4a3b32; line-height: 1.6; transform: rotate(-2deg); position: relative; }
        .close-note { position: absolute; top: 10px; right: 15px; font-size: 1.5rem; color: #aaa; cursor: pointer; }
        .secret-box { background: #fff; padding: 25px; border-radius: 20px; text-align: center; font-family: 'Inter', sans-serif; box-shadow: 0 10px 30px rgba(0,0,0,0.2); width: 250px; }
        .secret-input { width: 80%; padding: 10px; margin: 15px 0; border: 2px solid #eee; border-radius: 10px; font-family: 'Inter', sans-serif; outline: none; }
        .secret-btn { background: #d4a373; color: white; border: none; padding: 8px 20px; border-radius: 15px; font-weight: 600; cursor: pointer; }
        #hint { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); pointer-events: none; color: #d4a373; letter-spacing: 4px; font-size: 0.8rem; z-index: 10; display: none; }
        #music-status { position: fixed; top: 30px; left: 25px; font-size: 0.7rem; color: #d4a373; letter-spacing: 2px; font-weight: 600; text-transform: uppercase; display: none; }
        .flower { position: absolute; pointer-events: none; transform: translate(-50%, -50%) scale(0); animation: bloom 0.8s cubic-bezier(0.34, 1.56, 0.64, 1) forwards; filter: drop-shadow(4px 4px 6px rgba(0,0,0,0.1)); z-index: 10; }
        @keyframes bloom { to { transform: translate(-50%, -50%) scale(1) rotate(var(--r)); } }
        .bubble { position: absolute; background: #fff; padding: 10px 20px; border-radius: 2px 20px 20px 20px; font-family: 'Patrick Hand', cursive; font-size: 1.2rem; color: var(--text); pointer-events: none; animation: floatUpBubble 4s ease-out forwards; z-index: 100; white-space: nowrap; box-shadow: 2px 4px 15px rgba(0,0,0,0.05); transform: rotate(-2deg); }
        @keyframes floatUpBubble { 0% { opacity: 0; transform: translate(-50%, 10px) rotate(-2deg); } 15% { opacity: 1; transform: translate(-50%, 0) rotate(-2deg); } 100% { opacity: 0; transform: translate(-50%, -120px) rotate(5deg); } }
    </style>
</head>
<body>
    <div id="doodle-cursor"></div>
    <div class="grain-overlay"></div>

    <div id="start-container">
        <div id="background-layer"></div>
        <h1 class="invite-text">This is an invitation to my<br>possibly future friend : )</h1>
        <div class="sticker-wrapper">
            <div class="doodle-arrow">‚ûú</div>
            <div class="doodle-sparkle">‚ú®</div>
            <div class="sticker" id="sticker-btn">
                <div class="face face-front">Start Here</div>
                <div class="face face-back">Opening...</div>
            </div>
        </div>
        <div style="margin-top: 20px; color:#aaa; font-size:0.7rem; font-family:'Inter'; text-transform:uppercase; letter-spacing:1px; opacity:0.6;">&lt;&lt; PEEL TO OPEN</div>
    </div>

    <div id="page2-ui" onclick="handleOutsideClick(event)">
        <h2 id="page2-title">What i know about u</h2>

        <div class="credits-container" id="creditsContainer">
            <button class="credits-btn" onclick="toggleCredits(event)">Credits</button>
            <div class="credits-dropdown" id="creditsMenu">
                <div class="credit-item"><span class="credit-name">Faizan</span>Director</div>
                <div class="credit-item"><span class="credit-name">Gemini Pro</span>Writer</div>
                <div class="credit-item"><span class="credit-name">Time</span>lgta hai bhai</div>
            </div>
        </div>

        <div class="menu-container" id="menuContainer" onmouseenter="openMenu()" onmouseleave="closeMenu()">
            <div class="main-menu-btn" onclick="toggleMenuMobile(event)">+</div>
            <div class="tool-list" id="toolList">
                <div class="tool-btn" id="broom-btn" onclick="toggleEraser(event)">üßπ</div>
                <div class="tool-btn" onclick="openLetter()">üíå</div>
                <div class="tool-btn" onclick="openSecretLock()">üîí</div>
                <div class="tool-btn" onclick="takeScreenshotMode()">üì∏</div>
            </div>
        </div>

        <button class="next-btn" onclick="goToIntermediate()">Next ‚ûú</button>
    </div>

    <div id="intermediate-page">
        <p class="intermediate-text">So that's all i know about u & i bet theres more , but before that i got a question to ask u....</p>
        <button class="next-btn" style="position:relative; bottom:0; margin-top:30px; z-index:50;" onclick="goToFinalQuestion()">Ask me ‚ûú</button>
    </div>

    <div id="question-container">
        <div id="q-content">
            <h1 class="question-text">Will you be a my Mitr?</h1>
            <div class="option-group">
                <div class="option-sticker" style="transform: rotate(-2deg);" onclick="answer('yes')">Yess!</div>
                <div class="option-sticker" style="transform: rotate(3deg);" onclick="answer('think')">I will think</div>
                <div class="option-sticker" style="transform: rotate(-1deg);" onclick="answer('donno')">Umm donno</div>
                <div class="option-sticker" id="btn-nah" style="transform: rotate(2deg);" onmouseover="moveNah()" onclick="moveNah()">Nah...</div>
            </div>
        </div>

        <div id="final-msg"></div>
    </div>

    <div id="letter-modal" class="modal-overlay" onclick="closeModal('letter-modal')">
        <div class="paper-note" onclick="event.stopPropagation()">
            <span class="close-note" onclick="closeModal('letter-modal')">&times;</span>
            <p>Hey,<br><br>Just wanted to make something as cool as you.<br>Hope this brings a smile to your face!<br><br>- Faizan</p>
        </div>
    </div>

    <div id="secret-lock-modal" class="modal-overlay" onclick="closeModal('secret-lock-modal')">
        <div class="secret-box" onclick="event.stopPropagation()">
            <span class="close-note" onclick="closeModal('secret-lock-modal')">&times;</span>
            <h3>Top Secret ü§´</h3>
            <p style="font-size: 0.8rem; color: #888;">Enter Password:</p>
            <input type="text" id="secret-pass" class="secret-input" placeholder="???">
            <button class="secret-btn" onclick="checkPassword()">Unlock</button>
        </div>
    </div>

    <div id="secret-content-modal" class="modal-overlay" onclick="closeModal('secret-content-modal')">
        <div class="paper-note" style="background: #e3f2fd; transform: rotate(1deg);" onclick="event.stopPropagation()">
            <span class="close-note" onclick="closeModal('secret-content-modal')">&times;</span>
            <h3 style="text-align:center;">üéâ Access Granted!</h3>
            <p>(This space is waiting for your secret content...)</p>
        </div>
    </div>

    <div id="hint">TAP & DRAG</div>
    <div id="music-status"></div>
    <audio id="bg-audio"></audio>

    <script>
        // --- DOODLE CURSOR LOGIC ---
        const cursor = document.getElementById('doodle-cursor');
        document.addEventListener('mousemove', (e) => {
            cursor.style.left = e.clientX + 'px';
            cursor.style.top = e.clientY + 'px';
            const hovered = document.elementFromPoint(e.clientX, e.clientY);
            if (hovered && (hovered.tagName === 'BUTTON' || hovered.classList.contains('sticker') || hovered.classList.contains('tool-btn') || hovered.classList.contains('option-sticker') || hovered.classList.contains('main-menu-btn'))) {
                cursor.classList.add('hovering');
            } else { cursor.classList.remove('hovering'); }
        });
        document.addEventListener('mousedown', () => cursor.classList.add('clicking'));
        document.addEventListener('mouseup', () => cursor.classList.remove('clicking'));

        const playlist = ['song1.mp3', 'song2.mp3']; 
        let currentTrack = 0;
        const colors = ['#f8ad9d', '#fbc4ab', '#ffdab9', '#ece4db', '#d8e2dc'];
        const notes = [ "Independent person ‚úã", "Never sleeps.. ü¶â", "Possibly Batwoman? ü§î", "top-tier friend üèÜ", "elite music taste üòå", "10/10 human üåü", "insane vibes ‚ú®", "Nonchalant fr üò¨", "Caring ü´Ç", "Needs to be studied üßê", "secretly a genius üòé", "Nevers backsoff üëÄ", "linguistic person üìö" ];
        const aestheticVectors = ["|", "*", "¬∑", "~", "¬∞", "+"];

        const audio = document.getElementById('bg-audio');
        const startContainer = document.getElementById('start-container');
        const sticker = document.getElementById('sticker-btn');
        let isStarted = false;
        let isFinalPage = false;
        let isEraserActive = false;

        // --- GLOBAL AUDIO UNLOCKER ---
        document.body.addEventListener('click', () => {
            if (audio.paused && !isFinalPage) {
                audio.src = playlist[0];
                audio.play().catch(e => console.log("Waiting for interaction...", e));
            }
        }, { once: true });

        function initBackground() {
            const container = document.getElementById('background-layer');
            for(let i=0; i<50; i++) {
                const el = document.createElement('div'); el.className = 'bg-item';
                const size = Math.random() * 40 + 30; 
                if(Math.random() > 0.5) {
                    const color = colors[Math.floor(Math.random() * colors.length)];
                    el.innerHTML = `<svg width="${size}" height="${size}" viewBox="0 0 100 100"><circle cx="50" cy="30" r="25" fill="${color}" stroke="#5c4d42" stroke-width="1.5" stroke-opacity="0.3" /><circle cx="50" cy="70" r="25" fill="${color}" stroke="#5c4d42" stroke-width="1.5" stroke-opacity="0.3" /><circle cx="30" cy="50" r="25" fill="${color}" stroke="#5c4d42" stroke-width="1.5" stroke-opacity="0.3" /><circle cx="70" cy="50" r="25" fill="${color}" stroke="#5c4d42" stroke-width="1.5" stroke-opacity="0.3" /><circle cx="50" cy="50" r="12" fill="#fffcf2"/></svg>`;
                } else {
                    el.innerHTML = `<svg width="${size}" height="${size}" viewBox="0 0 100 100" fill="none" stroke="#d4a373" stroke-width="2.5" stroke-linecap="round"><path d="M10,50 Q30,10 50,50 T90,50" transform="rotate(${Math.random()*360} 50 50)"/></svg>`;
                }
                el.style.left = Math.random() * 100 + 'vw';
                el.style.animationDuration = (Math.random() * 15 + 15) + 's';
                el.style.animationDelay = (Math.random() * -30) + 's'; 
                container.appendChild(el);
            }
        }

        // --- PAGE 3 RAIN: AESTHETIC VECTORS ---
        function initVectorRain() {
            const container = document.getElementById('intermediate-page');
            for(let i=0; i<40; i++) { 
                const vec = document.createElement('div');
                vec.className = 'falling-item falling-vector';
                vec.innerText = aestheticVectors[Math.floor(Math.random() * aestheticVectors.length)];
                vec.style.left = Math.random() * 100 + 'vw'; // Fall from anywhere
                vec.style.animationDuration = (Math.random() * 8 + 5) + 's';
                vec.style.animationDelay = (Math.random() * 5) + 's';
                container.appendChild(vec);
            }
        }

        // --- PAGE 4 RAIN: ENVELOPES (ALL OVER) ---
        function initFinalRain() {
            const container = document.getElementById('question-container');
            
            // Falling Envelopes (ALL OVER)
            for(let i=0; i<25; i++) {
                const env = document.createElement('div'); env.className = 'falling-item falling-envelope';
                env.innerText = '‚úâÔ∏è';
                // Full Width (0-100vw)
                env.style.left = Math.random() * 100 + 'vw';
                env.style.animationDuration = (Math.random()*5 + 8) + 's';
                env.style.animationDelay = (Math.random()*5) + 's';
                container.appendChild(env);
            }
            // NO TEXTS HERE ANYMORE
        }

        let isDragging = false, startX = 0;
        function startDrag(e) { 
            if(isStarted) return; 
            isDragging = true; 
            startX = e.type.includes('touch') ? e.touches[0].clientX : e.clientX; 
            sticker.style.transition = 'none';
            if (audio.paused) { audio.src = playlist[0]; audio.play(); }
        }
        function drag(e) {
            if(!isDragging || isStarted) return;
            const clientX = e.type.includes('touch') ? e.touches[0].clientX : e.clientX;
            const deltaX = clientX - startX;
            if(deltaX > 0) return;
            let rotation = Math.max(deltaX / 1.2, -170);
            sticker.style.transform = `rotateY(${rotation}deg)`;
            if(rotation < -130) { isDragging = false; startExperience(); }
        }
        function endDrag() { if(!isDragging) return; isDragging = false; sticker.style.transition = 'transform 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275)'; sticker.style.transform = `rotateY(0deg)`; }

        sticker.addEventListener('mousedown', startDrag); window.addEventListener('mousemove', drag); window.addEventListener('mouseup', endDrag);
        sticker.addEventListener('touchstart', startDrag); window.addEventListener('touchmove', drag); window.addEventListener('touchend', endDrag);

        function startExperience() {
            if(isStarted) return; isStarted = true;
            sticker.style.transition = 'all 0.8s ease-in'; 
            sticker.style.transform = 'rotateY(-180deg) translateX(-100px) scale(1.1)'; 
            sticker.style.opacity = '0';
            if (audio.paused) { audio.src = playlist[0]; audio.play(); }
            setTimeout(() => {
                startContainer.style.opacity = '0';
                startContainer.style.visibility = 'hidden';
                const page2 = document.getElementById('page2-ui');
                page2.style.display = 'block';
                setTimeout(() => page2.style.opacity = '1', 50);
                document.getElementById('hint').style.display = 'block';
                document.getElementById('music-status').style.display = 'block';
                document.getElementById('music-status').innerText = "Vibing... üéµ";
            }, 800);
        }

        // --- PAPER SLIDE TRANSITIONS ---
        function goToIntermediate() {
            const current = document.getElementById('page2-ui');
            current.classList.add('paper-slide-out');
            document.getElementById('hint').style.display = 'none';
            setTimeout(() => {
                current.style.display = 'none';
                const next = document.getElementById('intermediate-page');
                next.style.display = 'flex';
                next.classList.add('paper-slide-in');
                initVectorRain();
            }, 800);
        }

        function goToFinalQuestion() {
            const current = document.getElementById('intermediate-page');
            current.classList.add('paper-slide-out'); // Reuse exit
            setTimeout(() => {
                current.style.display = 'none';
                const next = document.getElementById('question-container');
                next.style.display = 'flex';
                next.classList.add('paper-slide-in');
                isFinalPage = true;
                initFinalRain();
            }, 800);
        }

        function moveNah() {
            const btn = document.getElementById('btn-nah');
            const x = Math.random() * (window.innerWidth - 120);
            const y = Math.random() * (window.innerHeight - 100);
            btn.style.position = 'fixed'; btn.style.left = x + 'px'; btn.style.top = y + 'px';
        }

        function answer(type) {
            const msg = document.getElementById('final-msg');
            const container = document.getElementById('question-container');
            const content = document.getElementById('q-content');

            if(type === 'yes') {
                container.style.background = "#000";
                container.style.backgroundImage = "none";
                content.style.display = 'none';
                msg.innerHTML = '<h1 class="glowing-text">We Officially Now Mitrs ‚ú®</h1>';
                audio.pause();
                const celebration = new Audio('Song3.mp3');
                celebration.volume = 1.0;
                celebration.play().catch(e => console.log("Audio play error", e));
                explodeConfetti();
            } else if(type === 'think') {
                msg.innerText = "Take your time, I'm not going anywhere üòå";
                msg.style.color = "#d4a373";
            } else {
                msg.innerText = "I'll take that as a 'maybe soon' üòâ";
                msg.style.color = "#d4a373";
            }
        }

        function explodeConfetti() {
            const particles = ['üå∏', '‚úâÔ∏è', '‚ù§Ô∏è', '‚ú®', 'üíå', 'üëç'];
            for(let i=0; i<300; i++) {
                const c = document.createElement('div'); c.className = 'confetti';
                c.innerText = particles[Math.floor(Math.random() * particles.length)];
                c.style.left = '50%'; c.style.top = '50%';
                c.style.fontSize = Math.random()*20 + 10 + 'px';
                document.body.appendChild(c);
                const destX = (Math.random() - 0.5) * window.innerWidth * 1.5;
                const destY = (Math.random() - 0.5) * window.innerHeight * 1.5;
                const rotation = Math.random() * 720;
                const anim = c.animate([ { transform: 'translate(0,0) rotate(0deg)', opacity: 1 }, { transform: `translate(${destX}px, ${destY}px) rotate(${rotation}deg)`, opacity: 0 } ], { duration: 1500 + Math.random()*2000, easing: 'cubic-bezier(0.25, 1, 0.5, 1)' });
                anim.onfinish = () => c.remove();
            }
        }

        function openMenu() { document.getElementById('menuContainer').classList.add('menu-open'); }
        function closeMenu() { document.getElementById('menuContainer').classList.remove('menu-open'); }
        function toggleMenuMobile(e) { e.stopPropagation(); document.getElementById('menuContainer').classList.toggle('menu-open'); }
        function handleOutsideClick(e) { if (!e.target.closest('.menu-container')) { document.getElementById('menuContainer').classList.remove('menu-open'); } }

        function toggleEraser(e) {
            if(e) e.stopPropagation();
            isEraserActive = !isEraserActive;
            const btn = document.getElementById('broom-btn');
            if(isEraserActive) {
                btn.classList.add('active-tool');
                document.getElementById('hint').innerText = "TAP FLOWER TO ERASE";
                document.getElementById('hint').style.display = 'block';
            } else {
                btn.classList.remove('active-tool');
                document.getElementById('hint').innerText = "TAP & DRAG";
                document.getElementById('hint').style.display = 'none';
            }
        }

        function openLetter() { const m=document.getElementById('letter-modal'); m.style.display='flex'; setTimeout(()=>m.classList.add('open'),10); }
        function openSecretLock() { const m=document.getElementById('secret-lock-modal'); m.style.display='flex'; setTimeout(()=>m.classList.add('open'),10); }
        function closeModal(id) { const m=document.getElementById(id); m.classList.remove('open'); setTimeout(()=>m.style.display='none',300); }
        function checkPassword() { if(document.getElementById('secret-pass').value==="Im nonchalant"){ alert("Case Unlocked! (Instructions pending...)"); } else { alert("Wrong Password üò¨"); } }
        function takeScreenshotMode() { document.getElementById('page2-ui').style.opacity='0'; setTimeout(()=>document.getElementById('page2-ui').style.opacity='1',4000); }
        function toggleCredits(e) { e.stopPropagation(); document.getElementById('creditsMenu').classList.toggle('show'); }
        window.addEventListener('click', (e) => { if (!e.target.closest('.credits-container')) document.getElementById('creditsMenu').classList.remove('show'); });

        function handleInteraction(x, y) {
            const title = document.getElementById('page2-title');
            if(title && title.style.opacity > 0.1) title.style.opacity = '0';
            if(document.getElementById('start-container').style.opacity !== '0' && !isStarted) return;
            if(document.getElementById('intermediate-page').style.opacity === '1') return;
            if(isEraserActive) {
                const flowers = document.querySelectorAll('.flower');
                flowers.forEach(flower => {
                    const rect = flower.getBoundingClientRect();
                    const centerX = rect.left + rect.width / 2;
                    const centerY = rect.top + rect.height / 2;
                    if(Math.hypot(x - centerX, y - centerY) < 50) flower.remove();
                });
                return;
            }
            createFlower(x, y);
        }

        function createFlower(x, y) {
            const color = colors[Math.floor(Math.random() * colors.length)];
            const size = Math.random() * 40 + 50; 
            const flower = document.createElement('div'); flower.className = 'flower';
            flower.style.left = x + 'px'; flower.style.top = y + 'px'; 
            flower.style.setProperty('--r', Math.random()*360+'deg');
            flower.innerHTML = `<svg width="${size}" height="${size}" viewBox="0 0 100 100"><circle cx="50" cy="30" r="25" fill="${color}" stroke="rgba(0,0,0,0.05)"/><circle cx="50" cy="70" r="25" fill="${color}" stroke="rgba(0,0,0,0.05)"/><circle cx="30" cy="50" r="25" fill="${color}" stroke="rgba(0,0,0,0.05)"/><circle cx="70" cy="50" r="25" fill="${color}" stroke="rgba(0,0,0,0.05)"/><circle cx="50" cy="50" r="12" fill="#fffcf2"/><path d="M50 30 L50 70 M30 50 L70 50" stroke="rgba(0,0,0,0.1)" stroke-width="1.2"/></svg>`;
            document.body.appendChild(flower);
            if(Math.random() < 0.3) {
                const b = document.createElement('div'); b.className = 'bubble';
                b.style.left = x + 'px'; b.style.top = (y-60) + 'px';
                b.innerText = notes[Math.floor(Math.random()*notes.length)];
                document.body.appendChild(b); setTimeout(() => b.remove(), 4000);
            }
            if(document.querySelectorAll('.flower').length > 30) document.querySelector('.flower').remove();
        }

        let lastX=0, lastY=0;
        window.addEventListener('touchmove', (e) => {
            if(!isStarted) return;
            const t = e.touches[0];
            if(Math.hypot(t.clientX-lastX, t.clientY-lastY)>20) { handleInteraction(t.clientX, t.clientY); lastX=t.clientX; lastY=t.clientY; }
        }, {passive: false});
        window.addEventListener('mousemove', (e) => {
            if(!isStarted || e.buttons === 0) return;
            if(Math.hypot(e.clientX-lastX, e.clientY-lastY)>20) { handleInteraction(e.clientX, e.clientY); lastX=e.clientX; lastY=e.clientY; }
        });
        window.addEventListener('touchstart', (e) => {
            if(!isStarted || e.target.closest('button') || e.target.closest('.menu-container') || e.target.closest('.option-sticker') || e.target.closest('.paper-note')) return;
            document.getElementById('hint').style.display='none';
            handleInteraction(e.touches[0].clientX, e.touches[0].clientY);
        }, {passive:false});
        window.addEventListener('mousedown', (e) => {
            if(!isStarted || e.target.closest('button') || e.target.closest('.menu-container') || e.target.closest('.option-sticker') || e.target.closest('.paper-note')) return;
            document.getElementById('hint').style.display='none';
            handleInteraction(e.clientX, e.clientY);
        });

        initBackground();
        audio.addEventListener('ended', () => { currentTrack = (currentTrack+1)%playlist.length; audio.src = playlist[currentTrack]; audio.play(); });
    </script>
</body>
</html>
